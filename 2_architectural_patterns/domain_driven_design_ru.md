# Доменно-ориентированное проектирование

Доменно-ориентированное проектирование (DDD) предоставляет систематический подход к анализу сложных бизнес-проблем и моделированию программных решений. Методология состоит из двух взаимодополняющих частей: стратегического проектирования и тактического проектирования. Стратегическое проектирование фокусируется на понимании бизнес-домена и определении подходящих границ программного обеспечения. Тактическое проектирование предоставляет шаблоны реализации и строительные блоки для создания богатых доменных моделей в пределах этих границ.
![[DDD.png]]

**Основной принцип**: Стратегический DDD обнаруживает *границы* между контекстами и управляет *отношениями* между ними, в то время как тактический DDD определяет, что находится *внутри* каждого ограниченного контекста. Стратегический дизайн определяет границы контекста и шаблоны интеграции. Тактический дизайн реализует богатые доменные модели в пределах этих границ.

## Стратегический дизайн: общая картина

В стратегическом дизайне есть два основных «пространства»:

- **Пространство проблемы** — бизнес-домен в его реальном виде, независимый от каких-либо программных решений. Речь идет о понимании того, что необходимо решить.
- **Пространство решения** — место, где мы проектируем архитектуру программного обеспечения и границы для решения задач пространства проблемы.

### Пространство проблемы содержит:

- **Домен** — общая область или бизнес, в которой вы работаете
- **Поддомены** — логическое деление домена на основе бизнес-возможностей
- **Основной домен** — ключевые отличительные возможности, уникальные для вашего бизнеса
- **Вспомогательные поддомены** — необходимые, но не отличительные возможности
- **Общие поддомены** — сквозные проблемы, важные для понимания проблемы, но не уникальные для нее

### Пространство решения содержит:

- **Ограниченный контекст** — границы программного обеспечения, в пределах которых определяется модель домена
- **Карта контекста** — визуальное представление отношений между ограниченными контекстами и шаблонов интеграции
- **Шаблоны интеграции** — способы взаимодействия ограниченных контекстов (общий ядро, клиент-поставщик, антикоррупционный слой и т. д.)

### Понятия, общие для пространства проблем и пространства решений:

- **Универсальный язык** — общий словарный запас, который возникает в деловом общении, но становится языком реализации
- **Доменная модель** — понимание бизнес-концепций, которые становятся абстракциями программного обеспечения
- **Границы домена** — естественные бизнес-разделения, которые определяют границы программного обеспечения



## Тактический дизайн: строительные блоки

В то время как стратегический дизайн дает нам общее представление, тактический дизайн предоставляет конкретные шаблоны и строительные блоки, которые мы используем для реализации нашей доменной модели в каждом ограниченном контексте. В отличие от стратегического дизайна, который охватывает как пространство проблем, так и пространство решений, тактический дизайн работает в основном в пространстве решений, сосредоточиваясь на том, как мы структурируем наш код, чтобы он четко и понятно отражал бизнес-концепции.

### Пространство решений содержит:

#### Основные строительные блоки:

- **Сущности** — объекты с уникальной идентичностью, сохраняющиеся во времени (например, клиент с уникальным идентификатором)
- **Объекты-значения** — объекты, определяемые своими атрибутами, а не идентичностью (например, адрес или денежная сумма)
- **Агрегаты** — группы сущностей и объектов-значений, рассматриваемые как единое целое для изменения данных
- **Агрегатный корень** — единственная сущность в агрегате, на которую могут напрямую ссылаться внешние объекты
- **Доменные службы** — операции, которые по своей природе не принадлежат ни одной сущности или объекту значения
- **Репозитории** — абстракции для доступа к агрегатам и их хранения
- **Фабрики** — инкапсулируют логику создания сложных объектов или агрегатов

#### Поведенческие паттерны:

- **События домена** — значимые события, произошедшие в домене, которые важны для других частей системы
- **Службы приложений** — координируют объекты домена для выполнения сценариев использования, но сами не содержат бизнес-логики
- **Спецификации** — инкапсулируют бизнес-правила, которые можно комбинировать и повторно использовать

### Понятия, общие для пространства проблем и пространства решений:

- **Бизнес-правила** — ограничения и логика, существующие в реальном мире и обязательные для выполнения в коде
- **Концепции домена** — фундаментальные идеи и процессы из бизнес-домена, которые помогают реализовать тактические паттерны
- **Неизменяемые свойства домена** — условия, которые всегда должны выполняться в домене, обеспечиваемые агрегатами и другими паттернами

## Интеграция стратегического и тактического проектирования

Процесс DDD начинается с анализа пространства проблем, чтобы понять бизнес-задачу, требующую программных решений. Пространство проблем сосредоточено на домене, который содержит несколько поддоменов. В примере электронной коммерции домен состоит из рекомендаций по продуктам (основной поддомен), обработки заказов (вспомогательный поддомен) и аутентификации пользователей (общий поддомен).
Пространство решений содержит ограниченные контексты, которые определяют границы программного обеспечения и устанавливают отношения интеграции. Шаблоны интеграции существуют в пространстве решений, но основываются на отношениях в пространстве проблем. Естественные зависимости между поддоменами влияют на шаблоны интеграции между соответствующими ограниченными контекстами.

Внутри каждого ограниченного контекста тактические шаблоны проектирования реализуют модель домена. Ограниченный контекст «Обработка заказов» может содержать:
- сущность «Заказ» с управлением идентификацией и жизненным циклом
- Объекты значения OrderItem, определенные атрибутами продукта и количества
- OrderAggregate, обеспечивающий бизнес-инварианты, такие как «общая цена равна сумме позиций»
- OrderRepository, обеспечивающий постоянный доступ
- PricingService, обрабатывающий сложные вычисления, не относящиеся к конкретным сущностям

## Мост между пространствами

Домен (пространство проблем) и ограниченный контекст (пространство решений) связаны общими концепциями, наиболее важной из которых является модель домена. Эта модель охватывает оба пространства и определяет, как мы связываем домены и ограниченные контексты в одну целостную систему. Отношения могут быть много-к-многим: один ограниченный контекст может обращаться к нескольким поддоменам, а один поддомен может обращаться к нескольким ограниченным контекстам. Важно, что в разных ограниченных контекстах для одной бизнес-домены может быть несколько моделей домена, причем каждый контекст имеет свою собственную специализированную модель.

Универсальный язык обеспечивает общую терминологию для бизнес-заинтересованных сторон и технических специалистов. Термины могут иметь разные значения в разных ограниченных контекстах, но остаются однозначными в пределах каждого контекста. «Клиент» обозначает разные концепции: потенциальный клиент в контексте продаж, учетная запись в контексте биллинга и запрос на помощь в контексте поддержки. Тактические паттерны реализуют эти концепции последовательно — «клиент» может быть сущностью в контексте продаж, но объектом-значением в контексте биллинга, в зависимости от требований к идентичности.

## Процесс реализации

Стратегический и тактический дизайн работают итеративно, а не последовательно. Стратегический дизайн определяет соответствующие границы и понимание бизнес-ландшафта. Тактический дизайн реализует богатые, поддерживаемые доменные модели в установленных границах. Процесс начинается со стратегического анализа, но позволяет использовать тактические идеи реализации для стратегических изменений.

Доменная модель возникает в результате итеративного понимания бизнеса и реализации программного обеспечения, которое точно отражает бизнес-операции.

## Преимущества фреймворка

DDD обеспечивает систематическую навигацию по сложным взаимосвязям между бизнесом и программным обеспечением. Фреймворк связывает высокоуровневый анализ домена с конкретными шаблонами реализации, делая сложные концепции доступными и взаимосвязанными. Это позволяет эффективно применять DDD в разработке производственного программного обеспечения.

DDD создает программное обеспечение, которое точно отражает и поддерживает бизнес-операции на всех уровнях архитектуры, от стратегических решений до детальных выборов реализации.